# Docker

## Содержание
* [Данные для подключения](#данные-для-подключения)
    * [web](#web)
    * [mysql](#mysql)
    * [redis](#redis)
    * [redis web ui](#redis-webui)
    * [elasticsearch](#elasticsearch)
* [Предисловие](#предисловие)
* [Установка](#установка)
* [Обновление](#обновление)


### Данные для подключения:

#### web
* Адрес: [localhost](http://localhost)
* Порт: `80`

#### ssh
* Адрес: [localhost](ssh://localhost)
* Порт: `22`
* Логин: `root`
* Пароль: отсутствует. Используется указанный SSH-ключ.

#### mysql
* Адрес: `mysql`
* Порт: `3306`
* Логин: `root`
* Пароль: `secret`

#### redis
* Адрес: `redis`
* Порт: `6379`

#### redis-webui
* Адрес: [localhost](http://localhost:9987)
* Порт: `9987`
* Логин: `root`
* Пароль: `secret`

#### elasticsearch
* Адрес: [localhost](http://localhost)
* Порт: `9200`


### Предисловие

Если Вы разворачиваете уже созданный с подключенным докером проект, то переходите к пункту 5 раздела [установка](#установка).


### Установка

1. Скачать и установить [docker](https://download.docker.com/win/stable/Docker%20for%20Windows%20Installer.exe)
2. В основных настройках докера обязательно включить галку "Expose docker on tcp://localhost:2375 without TLS"
![2](_docs/2-1.png)

3. На вкладке "Advanced" настроить выделение ядер, оперативной памяти и расположение файла образа.
![3](_docs/3-1.png)

4. В подключаемом проекте должен быть инициализирован git-репозиторий.
   Выполнить консольную команду `git submodule add git@git.avangard-mb.ru:avangard/docker.git` для подключения пакета в качестве субмодуля, либо подключить его через `Git Extensions`:
   * ![4-1](_docs/4-1.png)
   * ![4-2](_docs/4-2.png)
   * ![4-3](_docs/4-3.png)
   
5. Скопировать файл `docker/.env.example` в `.env`.

6. После подключения субмодуля, в phpStorm на файле `docker/docker-compose.yml` кликнуть правой кнопкой мыши и выбрать пункт `Create 'docker: Compose Deployment'`
    ![6-1](_docs/6-1.png)
   * В открывшемся окне можно переименовать подключение в `docker` для удобства, а также нажать кнопку выбора сервера:
   ![6-2](_docs/6-2.png)
   * В настройках проверить чтобы галка стояла на пункте `TCP socket`, затем в путях укажите расположение папки с проектами на Вашем компе.
   ![6-3](_docs/6-3.png)
   Например, если у Вас папка с сайтами лежит в `G:/MyFolder/MySites/Projects`, то нужно указать:
       * virtual machine path: `/g/MyFolder/MySites/Projects`
       * local path: `G:/MyFolder/MySites/Projects`
   * Сохраняете все данные

7. На панели инструментов запускаете на выполнение Ваше соединение, например, `docker`.
   ![7-1](_docs/7-1.png)

8. В случае, если пакет подключен в проект с одним сайтом, просто откройте в браузере [http://localhost](http://localhost).
   Если в проекте несколько поддоменов, то их нужно прописать в файле `hosts`:
   ```
   127.0.0.1 foo.example.com
   127.0.0.1 bar.example.com
   127.0.0.1 baz.example.com
   ```

Теперь, при повторном запуске проекта все что нужно сделать - это запустить докер:
![7-1](_docs/7-1.png)


### Обновление

Для обновления репозитория докера:
![update](_docs/update.png)
